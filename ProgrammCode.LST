A51 MACRO ASSEMBLER  PROGRAMMCODE                                                         05/24/2016 17:36:01 PAGE     1


MACRO ASSEMBLER A51 V8.00
OBJECT MODULE PLACED IN ProgrammCode.OBJ
ASSEMBLER INVOKED BY: C:\Keil\C51\BIN\A51.EXE ProgrammCode.asm SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

----                   1     cseg at 0
0000 8022              2     jmp main
                       3     
                       4     
                       5     ;Externe Interrupt
                       6     ;------------------------------------------------------------------------------------------
                             ---
                       7     ;P3.2  level hochzählen
0003                   8     org 03h 
0003 E532              9                                                     mov a,level
0005 B40F12           10                                                     cjne a,#000Fh,erhoehe
0008 C3               11     zurueckerhoehe:                 clr C
0009 32               12                                                     reti
                      13     
                      14     
0013                  15     org 13h 
0013 E532             16                                                     mov a,level
0015 B40007           17                                                     cjne a,#0000h,vermindere
0018 C3               18     zurueckvermindere:              clr C
0019 32               19                                                     reti
                      20     ;------------------------------------------------------------------------------------------
                             ---
001A 0532             21     erhoehe:                inc level
001C 020008           22                                     ljmp zurueckerhoehe
001F 1532             23     vermindere:     dec level
0021 020018           24                                     ljmp zurueckvermindere
                      25     
                      26     ;------------------------------------------------------------------------------------------
                             ---
                      27     
                      28     ;Einsprung (Hauptprogramm)
0024                  29     main:
                      30                                                                     ;Vorbereitung für PGM
                      31     ;------------------------------------------------------------------------------------------
                             -------------------------------------------------
                      32     
                      33     ;Interrupts vorbereiten
                      34     ;------------------------------------------------------------------------------------------
                             ---
0024 D2AF             35     setb ea
0026 D2A8             36     setb ex0
0028 D288             37     setb IT0                                        ;Übernehmen bei Aballender Flanke des Inter
                             rupts 0
002A D2AA             38     setb ex1
002C D28A             39     setb IT1
                      40     ;------------------------------------------------------------------------------------------
                             ---
                      41     
                      42     
                      43     ;Equals (Zuweisung der ''Variablen'')
                      44     ;------------------------------------------------------------------------------------------
                             ---
  0030                45     anfangswert equ 30h
  0031                46     endwert equ 31h
  0032                47     level equ 32h
  0033                48     zeahlfaktor equ 33h
  0034                49     uberlaufzahler equ 34h
                      50     ;------------------------------------------------------------------------------------------
A51 MACRO ASSEMBLER  PROGRAMMCODE                                                         05/24/2016 17:36:01 PAGE     2

                             ---
                      51     
                      52     
                      53     ;Port zuweisung
                      54     ;------------------------------------------------------------------------------------------
                             ---
  00A0                55     Ausgabeport equ p2.0
  0080                56     AusgabeDisplayport equ p0
                      57     ;------------------------------------------------------------------------------------------
                             ---
                      58     
                      59     
                      60     ;Config (Startwerte für das Programm
                      61     ;------------------------------------------------------------------------------------------
                             ---
002E 753001           62     mov anfangswert,#1
0031 7531FF           63     mov endwert,#255
0034 753200           64     mov level,#0            
0037 753400           65     mov uberlaufzahler,#0
                      66     ;------------------------------------------------------------------------------------------
                             ---
                      67     
                      68     
                      69     ;Timer init (Einstellungen des Timers)
                      70     ;------------------------------------------------------------------------------------------
                             ---
003A 5389FB           71     anl tmod,#11111011b     
003D 438901           72     orl tmod,#01h
0040 85308A           73     mov tl0,anfangswert
0043 85318C           74     mov th0,endwert
                      75     ;------------------------------------------------------------------------------------------
                             ---
                      76     
                      77     ;------------------------------------------------------------------------------------------
                             -------------------------------------------------
                      78     
                      79     
                      80     ;Start des eigentlichen Programms
0046 1189             81     call anzeigen
0048 8000             82     jmp aus
                      83     
                      84     
                      85     ;Auszyklus für den Motor
                      86     ;------------------------------------------------------------------------------------------
                             ---
004A                  87     aus:
004A 85308A           88     mov tl0,anfangswert
004D 85318C           89     mov th0,endwert
0050 C3               90     clr C
0051 92A0             91     mov Ausgabeport,C
0053 740F             92     mov A,#15                                       ;Akku mit Konstante 15 vorladen
0055 C3               93     clr C                                           ;Carry bit auf 0 setzen
0056 9532             94     SUBB A,level                            ;Level wird von 10 Abgezogen um die "Aus" Zeit des 
                             Ports zu bestimmen allerdings wird das doppelte benötigt (ein durchgang nur 0,06s lang)
0058 F533             95     mov zeahlfaktor,A                       ; anzahl an duchgängen des zählers mal 2
                      96     
005A D28C             97     setb tr0 
005C 1177             98     call zaehlen
005E C28C             99     clr tr0
                     100     
0060 8000            101     jmp an
                     102     ;------------------------------------------------------------------------------------------
                             ---
                     103     
                     104     
                     105     ;Auszyklus für den Motor
A51 MACRO ASSEMBLER  PROGRAMMCODE                                                         05/24/2016 17:36:01 PAGE     3

                     106     ;------------------------------------------------------------------------------------------
                             ---
0062                 107     an:
0062 85308A          108     mov tl0,anfangswert
0065 85318C          109     mov th0,endwert
0068 D3              110     setb C
0069 92A0            111     mov Ausgabeport,C
006B E532            112     mov A,level                                     ;Akku mit level laden           
006D F533            113     mov zeahlfaktor,A
                     114                             
006F D28C            115     setb tr0 
0071 1177            116     call zaehlen
0073 C28C            117     clr tr0
                     118     
0075 80D3            119     jmp aus
                     120     ;------------------------------------------------------------------------------------------
                             ---
                     121     
                     122     
                     123     ;Zeitliche verzögerung für den aus bzw an zustand des Motors
                     124     ;Überprüfung ob Zähler schon so oft übergelaufen ist wie gewünscht
                     125     ;------------------------------------------------------------------------------------------
                             ---
0077                 126     zaehlen:
                     127                                                                             ;Starten von timer
0077 E533            128     mov a,zeahlfaktor                                                       ;zeahlfaktor wird g
                             eladen(Wie oft Überlaufen soll, wird in akku geladen)
0079 B53404          129     cjne a,uberlaufzahler,uberlaufcheck                     ;Akku mit Überlaufzähler vergleiche
                             n wenn ungleich sprung nach uberlaufcheck sonst weiter
007C 753400          130     mov uberlaufzahler,#00h
                     131     
007F 22              132     ret                                                                                     ;sp
                             ringe zurück zur stelle nach dem zaehlen aufgerufen wurde
                     133     ;------------------------------------------------------------------------------------------
                             ---
                     134     
                     135     
                     136     ;Überprüfung ob der Zähler übergelaufen ist
                     137     ;------------------------------------------------------------------------------------------
                             ---
0080                 138     uberlaufcheck:
0080 308DF4          139     jnb tf0,zaehlen                         ;Timer Überlauf? wenn nein, springe zu zaehlen
0083 0534            140     inc uberlaufzahler
0085 C28D            141     clr tf0
0087 80EE            142     jmp zaehlen
                     143     ;------------------------------------------------------------------------------------------
                             ---
                     144     
                     145     
                     146     ;Ausgabe an der 7-Segment-Anzeige
                     147     ;------------------------------------------------------------------------------------------
                             ---
0089                 148     anzeigen:                                       
0089 E532            149                     mov a, level                                    ; Zahl an level einlesen   
                                  
008B 540F            150                     anl a, #0Fh                                             ; obere 4 Bits ausb
                             lenden
008D 900094          151                     mov dptr, #seg7code                     ; Datenpointer init.
0090 93              152                     movc a, @a+dptr                                 ; ROM-Zugriff
0091 F580            153                     mov AusgabeDisplayport, a               ; Zahl anzeigen
0093 22              154                     ret
                     155     ;------------------------------------------------------------------------------------------
                             ---
                     156     
                     157     
                     158     ;look-up Tabelle für die 7-Segment-Anzeige
A51 MACRO ASSEMBLER  PROGRAMMCODE                                                         05/24/2016 17:36:01 PAGE     4

                     159     ;------------------------------------------------------------------------------------------
                             ---
0094 7E12BCB6        160     seg7code:   DB 01111110b,00010010b,10111100b,10110110b
0098 D2E6EE32        161                             DB 11010010b,11100110b,11101110b,00110010b
009C FEF6FACE        162                             DB 11111110b,11110110b,11111010b,11001110b
00A0 6C9EECE8        163                             DB 01101100b,10011110b,11101100b,11101000b      
                     164     ;------------------------------------------------------------------------------------------
                             ---
                     165     
                     166             
                     167                                             
                     168     end     
A51 MACRO ASSEMBLER  PROGRAMMCODE                                                         05/24/2016 17:36:01 PAGE     5

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

AN . . . . . . . .  C ADDR   0062H   A   
ANFANGSWERT. . . .  N NUMB   0030H   A   
ANZEIGEN . . . . .  C ADDR   0089H   A   
AUS. . . . . . . .  C ADDR   004AH   A   
AUSGABEDISPLAYPORT  D ADDR   0080H   A   
AUSGABEPORT. . . .  B ADDR   00A0H.0 A   
EA . . . . . . . .  B ADDR   00A8H.7 A   
ENDWERT. . . . . .  N NUMB   0031H   A   
ERHOEHE. . . . . .  C ADDR   001AH   A   
EX0. . . . . . . .  B ADDR   00A8H.0 A   
EX1. . . . . . . .  B ADDR   00A8H.2 A   
IT0. . . . . . . .  B ADDR   0088H.0 A   
IT1. . . . . . . .  B ADDR   0088H.2 A   
LEVEL. . . . . . .  N NUMB   0032H   A   
MAIN . . . . . . .  C ADDR   0024H   A   
P0 . . . . . . . .  D ADDR   0080H   A   
P2 . . . . . . . .  D ADDR   00A0H   A   
SEG7CODE . . . . .  C ADDR   0094H   A   
TF0. . . . . . . .  B ADDR   0088H.5 A   
TH0. . . . . . . .  D ADDR   008CH   A   
TL0. . . . . . . .  D ADDR   008AH   A   
TMOD . . . . . . .  D ADDR   0089H   A   
TR0. . . . . . . .  B ADDR   0088H.4 A   
UBERLAUFCHECK. . .  C ADDR   0080H   A   
UBERLAUFZAHLER . .  N NUMB   0034H   A   
VERMINDERE . . . .  C ADDR   001FH   A   
ZAEHLEN. . . . . .  C ADDR   0077H   A   
ZEAHLFAKTOR. . . .  N NUMB   0033H   A   
ZURUECKERHOEHE . .  C ADDR   0008H   A   
ZURUECKVERMINDERE.  C ADDR   0018H   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
